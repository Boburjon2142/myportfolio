{% extends "base.html" %}

{% block title %}Yutuqlar{% endblock %}

{% block content %}
<header class="gallery-hero text-white text-center">
    <div class="container">
        <h1 class="mb-3">Yutuqlar Galereyasi</h1>
        <p class="hero-subtitle">Natijalarni turkumlar, yillar va texnologiyalar orqali filtrlab ko'ring.</p>
    </div>
</header>

<section class="filter-section">
    <div class="container">
        <form method="get" class="filter-card">
            <div class="search-container">
                <div class="search-box">
                    <input type="search" class="search-input" name="search" placeholder="Kalit so'z" value="{{ filters.search }}" data-debounce="true">
                    <div class="search-icon"><i class="fas fa-search"></i></div>
                </div>
            </div>
            <div class="filter-container">
                <div class="filter-group">
                    <label class="filter-label">Kategoriya</label>
                    <select name="category" class="filter-select">
                        <option value="">Barcha kategoriyalar</option>
                        {% for value, label in categories %}
                            <option value="{{ value }}" {% if filters.category == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Yil</label>
                    <select name="year" class="filter-select">
                        <option value="">Barcha yillar</option>
                        {% for item in years %}
                            <option value="{{ item }}" {% if filters.year == item|stringformat:"s" %}selected{% endif %}>{{ item }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Texnologiya</label>
                    <select name="technology" class="filter-select">
                        <option value="">Barcha texnologiyalar</option>
                        {% for technology in technologies %}
                            <option value="{{ technology.slug }}" {% if filters.technology == technology.slug %}selected{% endif %}>{{ technology.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="filter-group align-self-end">
                    <button class="filter-btn" type="submit"><i class="fas fa-filter me-1"></i>Filtrlash</button>
                </div>
            </div>
            <div class="filter-tags">
                <span class="filter-tag {% if not filters.category %}active{% endif %}" data-filter="">Barchasi</span>
                {% for value, label in categories %}
                    <span class="filter-tag {% if filters.category == value %}active{% endif %}" data-filter="{{ value }}">{{ label }}</span>
                {% endfor %}
            </div>
        </form>
    </div>
</section>

<section class="container py-5">
    <div class="gallery">
        {% for achievement in page_obj %}
            <article class="achievement-card" data-category="{{ achievement.category|lower }}" data-year="{{ achievement.date|date:"Y" }}" data-tech="{% if achievement.technologies.first %}{{ achievement.technologies.first.slug }}{% endif %}">
                {% if achievement.image %}
                    <div class="card-image" style="background-image:url('{{ achievement.image.url }}'); background-size:cover; background-position:center;">
                        <span class="card-badge">{{ achievement.get_category_display }}</span>
                        <span class="card-date">{{ achievement.date|date:"d M Y" }}</span>
                    </div>
                {% else %}
                    <div class="card-image">
                        <span class="card-badge">{{ achievement.get_category_display }}</span>
                        <span class="card-date">{{ achievement.date|date:"d M Y" }}</span>
                        <i class="fas fa-award"></i>
                    </div>
                {% endif %}
                <div class="card-content">
                    <span class="card-category {% if achievement.category == 'AWARD' %}mukofot{% elif achievement.category == 'CERTIFICATE' %}sertifikat{% elif achievement.category == 'COMPETITION' %}tanlov{% endif %}">{{ achievement.get_category_display }}</span>
                    <h3 class="card-title">{{ achievement.title }}</h3>
                    <p class="card-description">{{ achievement.short_description }}</p>
                    <a href="{% url 'achievements:detail' achievement.slug %}" class="card-link">Batafsil <i class="fas fa-arrow-right"></i></a>
                </div>
            </article>
        {% empty %}
            <p class="text-muted">Tanlangan filtrlar bo'yicha natija topilmadi.</p>
        {% endfor %}
    </div>

    {% if page_obj.has_other_pages %}
        <div class="pagination mt-4">
            {% if page_obj.has_previous %}
                <a class="page-btn" href="?page={{ page_obj.previous_page_number }}{% if filters.search %}&search={{ filters.search }}{% endif %}{% if filters.category %}&category={{ filters.category }}{% endif %}{% if filters.year %}&year={{ filters.year }}{% endif %}{% if filters.technology %}&technology={{ filters.technology }}{% endif %}">Oldingi</a>
            {% endif %}
            <span class="page-info">Sahifa {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
            {% if page_obj.has_next %}
                <a class="page-btn" href="?page={{ page_obj.next_page_number }}{% if filters.search %}&search={{ filters.search }}{% endif %}{% if filters.category %}&category={{ filters.category }}{% endif %}{% if filters.year %}&year={{ filters.year }}{% endif %}{% if filters.technology %}&technology={{ filters.technology }}{% endif %}">Keyingi</a>
            {% endif %}
        </div>
    {% endif %}
</section>
{% endblock %}
